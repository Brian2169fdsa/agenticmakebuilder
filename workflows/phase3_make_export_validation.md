# Workflow: Phase 3 — Make.com Export Validation

## Objective

Validate the structural correctness of a Make.com blueprint JSON generated by Phase 2, ensuring it conforms to Make.com's expected import format.

---

## Required Inputs

1. **Blueprint** — Make.com export JSON from Phase 2
2. **Module registry** — Optional but recommended for module-specific checks

---

## Steps

### Step 1: Run Validation (Tool)

Invoke: `validate_make_export(blueprint, registry)`

This runs ~30 checks across 6 rule categories:

| Category | Code | Checks | Focus |
|----------|------|--------|-------|
| Root Structure | MR | 5 | dict type, name, flow array, metadata, non-empty flow |
| Flow Integrity | MF | 8 | integer IDs, uniqueness, trigger first, module/version fields, registry, orphans |
| Module Structure | MM | 7 | designer metadata, parameters, mapper type, onerror format, filters, version match |
| Router/Routes | MT | 4 | routes array, >= 2 routes, flow arrays, non-empty flows |
| Credentials | MC | 3 | __IMTCONN__ format, placeholder pattern, required credentials present |
| Designer/Metadata | MD | 3 | scenario object, maxErrors, designer.orphans |

### Step 2: Evaluate Results (Agent)

**If zero errors:**
- Proceed to Phase 5 (Version + Save)
- Skip Phase 4 (Self-Heal)

**If errors exist:**
- Check if errors are repairable (see Phase 4 supported repairs)
- Proceed to Phase 4 for self-healing

**If only warnings:**
- Proceed normally (warnings are informational)

---

## Tools Used

| Tool | File | Purpose |
|------|------|---------|
| validate_make_export | `/tools/validate_make_export.py` | Structural validation of Make blueprint |

---

## Success Criteria

Phase 3 is complete when:
- [ ] Validation report generated with checks_run, checks_passed, errors, warnings
- [ ] Blueprint passes all checks (zero errors) — OR errors forwarded to Phase 4
- [ ] Validation report is structured and machine-readable

---

## Edge Cases

| Edge Case | Handling |
|-----------|----------|
| Blueprint is not a dict | MR-001 catches immediately; remaining checks skipped |
| Missing flow array | MR-003 error; flow treated as empty for remaining checks |
| Router without routes | MT-001 error; flagged for Phase 4 repair |
| Module not in registry | MF-007 error (not repairable by self-heal) |
| Empty router route flow | MT-004 warning (not an error) |
| Numeric __IMTCONN__ value | MC-001 error — likely a real credential leak |

---

## Stopping Conditions

- **STOP** if blueprint is not a dict (MR-001 fatal)
- All other errors are reported but do not halt validation

---

## What This Workflow Does NOT Do

- Does NOT repair errors (that is Phase 4)
- Does NOT validate canonical spec (that is Phase 1)
- Does NOT make API calls to Make.com
